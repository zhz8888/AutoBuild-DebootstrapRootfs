name: Auto_Build_DebootstrapRootfs

on:
#  release:
#    types: [published]
#  push:
#    branches:
#      - master
#    paths:
#      - '.config'
#  schedule:
#    - cron: 0 8 * * 5
  watch:
    types: [started]

env:
  ARCH: arm64
  version: bullseye

jobs:
  build:
    runs-on: ubuntu-18.04
    if: github.event.repository.owner.id == github.event.sender.id

    steps:
    - name: Check Out
      uses: actions/checkout@v2

    - name: Install Core Packages
      run: |
        sudo apt update
        sudo apt-get install debootstrap neofetch -y
        sudo apt upgrade -y

    - name: Build Rootfs
      run: |
        mkdir rootfs
        sudo debootstrap --arch=$ARCH --foreign $version rootfs

    - name: Zip Rootfs
      run: |
        cd rootfs
        tar -zcvf rootfs-$version-$ARCH.tar.gz *
        mv rootfs-$version-$ARCH.tar.gz ../
        cd ..

    - name: Upload Rootfs
      uses: actions/upload-artifact@v2
      with:
        name: Rootfs
        path: rootfs-*.tar.gz
        if-no-files-found: error

#    下面两项为开启Actions的SSH，仅作为调试使用，如需使用则删除前面的 '#' 即可
#    - name: SSH Connection To Actions
#      uses: P3TERX/debugger-action@master
#    当有任务失败时打开SSH，建议搭配上面使用，使用方法同上
#      if: failure()
